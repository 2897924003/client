import{a as E,Q as V}from"./QInput-ZZVRyBCj.js";import{l as L,r as x,m as A,n as k,o as I,h as R,p as j,g as z,v as D,q as Q,t as T,x as $,y as H,_ as N,u as O,z as U,A as G,B as b,Q as K,C as M,D as J,f as m,E as B,G as F,H as W,k as P}from"./index-CfKCQbFi.js";import{Q as X}from"./QPage-DZQMDliE.js";import"./use-id-Bhf5A-tA.js";const Y=L({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(u,{slots:f,emit:n}){const v=z(),i=x(null);let l=0;const s=[];function g(e){const c=typeof e=="boolean"?e:u.noErrorFocus!==!0,h=++l,w=(t,a)=>{n("validation"+(t===!0?"Success":"Error"),a)},q=t=>{const a=t.validate();return typeof a.then=="function"?a.then(r=>({valid:r,comp:t}),r=>({valid:!1,comp:t,err:r})):Promise.resolve({valid:a,comp:t})};return(u.greedy===!0?Promise.all(s.map(q)).then(t=>t.filter(a=>a.valid!==!0)):s.reduce((t,a)=>t.then(()=>q(a).then(r=>{if(r.valid===!1)return Promise.reject(r)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return h===l&&w(!0),!0;if(h===l){const{comp:a,err:r}=t[0];if(r!==void 0&&console.error(r),w(!1,a),c===!0){const S=t.find(({comp:C})=>typeof C.focus=="function"&&D(C.$)===!1);S!==void 0&&S.comp.focus()}}return!1})}function d(){l++,s.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function p(e){e!==void 0&&Q(e);const c=l+1;g().then(h=>{c===l&&h===!0&&(u.onSubmit!==void 0?n("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function o(e){e!==void 0&&Q(e),n("reset"),T(()=>{d(),u.autofocus===!0&&u.noResetFocus!==!0&&y()})}function y(){E(()=>{if(i.value===null)return;const e=i.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||i.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||i.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(i.value.querySelectorAll("[tabindex]"),c=>c.tabIndex!==-1);e?.focus({preventScroll:!0})})}$(H,{bindComponent(e){s.push(e)},unbindComponent(e){const c=s.indexOf(e);c!==-1&&s.splice(c,1)}});let _=!1;return A(()=>{_=!0}),k(()=>{_===!0&&u.autofocus===!0&&y()}),I(()=>{u.autofocus===!0&&y()}),Object.assign(v.proxy,{validate:g,resetValidation:d,submit:p,reset:o,focus:y,getValidationComponents:()=>s}),()=>R("form",{class:"q-form",ref:i,onSubmit:p,onReset:o},j(f.default))}}),Z={class:"q-pa-md",style:{"max-width":"400px"}},ee={class:"row justify-around"},te={__name:"LoginLayout",setup(u){const f=M(),n=x(null),v=x(null),i=J(),l=O(),s=async()=>{const d=await P.post("api/client-login",{username:n.value,password:v.value},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});d.data.code===1?(f.notify({message:"欢迎!",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}),l.login(n.value),await i.push("/mainlayout")):d.data.code===1e3?f.notify({message:d.data.message,position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}):f.notify({message:"请仔细检查您的账号密码",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})},g=async()=>{(await P.post("api/client-register",{username:n.value,password:v.value},{headers:{"Content-Type":"application/json"}})).data.code===1?f.notify({message:"注册成功!",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}):f.notify({message:"账号已存在",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})};return(d,p)=>(U(),G(K,{view:"lHh Lpr lFf"},{default:b(()=>[m(W,null,{default:b(()=>[m(X,{class:"login-page-background flex flex-center",style:{"max-width":"100%","max-height":"100%"}},{default:b(()=>[B("div",Z,[m(Y,{onSubmit:s,class:"q-gutter-md"},{default:b(()=>[m(V,{"bg-color":"white",rounded:"",outlined:"",modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=o=>n.value=o),label:"账号","lazy-rules":"",rules:[o=>o&&o.length>0||"不能为空"]},null,8,["modelValue","rules"]),m(V,{"bg-color":"white",rounded:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":p[1]||(p[1]=o=>v.value=o),label:"密码","lazy-rules":"",rules:[o=>o!==null&&o!==""||"不能为空",o=>o.length>0&&o.length<20||"密码过长"]},null,8,["modelValue","rules"]),B("div",ee,[m(F,{label:"登录",type:"login",color:"blue"}),m(F,{label:"注册",onClick:g,color:"blue"})])]),_:1})])]),_:1})]),_:1})]),_:1}))}},ue=N(te,[["__scopeId","data-v-da1e8fe7"],["__file","LoginLayout.vue"]]);export{ue as default};
