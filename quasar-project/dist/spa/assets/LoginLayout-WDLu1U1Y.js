import{a as P,Q as C,b as A}from"./QCheckbox-BZ46gQS0.js";import{l as E,r as x,m as L,n as I,o as j,h as R,p as z,g as D,v as T,q as Q,t as U,x as $,y as H,_ as M,u as N,z as O,A as G,B as b,Q as K,C as J,D as W,f as m,E as k,G as B,H as X,k as F}from"./index-tN1zz_Ou.js";import{Q as Y}from"./QPage-DopVnRwr.js";import"./use-id-CUknjMLC.js";const Z=E({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(i,{slots:p,emit:s}){const v=D(),d=x(null);let c=0;const a=[];function g(e){const f=typeof e=="boolean"?e:i.noErrorFocus!==!0,y=++c,_=(o,n)=>{s("validation"+(o===!0?"Success":"Error"),n)},S=o=>{const n=o.validate();return typeof n.then=="function"?n.then(l=>({valid:l,comp:o}),l=>({valid:!1,comp:o,err:l})):Promise.resolve({valid:n,comp:o})};return(i.greedy===!0?Promise.all(a.map(S)).then(o=>o.filter(n=>n.valid!==!0)):a.reduce((o,n)=>o.then(()=>S(n).then(l=>{if(l.valid===!1)return Promise.reject(l)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(o===void 0||o.length===0)return y===c&&_(!0),!0;if(y===c){const{comp:n,err:l}=o[0];if(l!==void 0&&console.error(l),_(!1,n),f===!0){const V=o.find(({comp:q})=>typeof q.focus=="function"&&T(q.$)===!1);V!==void 0&&V.comp.focus()}}return!1})}function h(){c++,a.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function r(e){e!==void 0&&Q(e);const f=c+1;g().then(y=>{f===c&&y===!0&&(i.onSubmit!==void 0?s("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function u(e){e!==void 0&&Q(e),s("reset"),U(()=>{h(),i.autofocus===!0&&i.noResetFocus!==!0&&t()})}function t(){P(()=>{if(d.value===null)return;const e=d.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||d.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||d.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(d.value.querySelectorAll("[tabindex]"),f=>f.tabIndex!==-1);e?.focus({preventScroll:!0})})}$(H,{bindComponent(e){a.push(e)},unbindComponent(e){const f=a.indexOf(e);f!==-1&&a.splice(f,1)}});let w=!1;return L(()=>{w=!0}),I(()=>{w===!0&&i.autofocus===!0&&t()}),j(()=>{i.autofocus===!0&&t()}),Object.assign(v.proxy,{validate:g,resetValidation:h,submit:r,reset:u,focus:t,getValidationComponents:()=>a}),()=>R("form",{class:"q-form",ref:d,onSubmit:r,onReset:u},z(p.default))}}),ee={class:"q-pa-md",style:{"max-width":"400px"}},te={class:"row justify-around"},oe={__name:"LoginLayout",setup(i){const p=J(),s=x(null),v=x(null),d=W(),c=N(),a=x(!1),g=async()=>{const r=await F.post("https://smooth-werewolf-rich.ngrok-free.app/api/client-login",{username:s.value,password:v.value,"remember-me":a.value?"on":"off"},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});r.data.code===1?(sessionStorage.setItem("jwt",r.headers.getAuthorization()),p.notify({message:"欢迎!",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}),c.login(s.value),await d.push("/mainlayout")):r.data.code===1e3?p.notify({message:r.data.message,position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}):p.notify({message:"请仔细检查您的账号密码",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})},h=async()=>{(await F.post("https://smooth-werewolf-rich.ngrok-free.app/api/client-register",{username:s.value,password:v.value},{headers:{"Content-Type":"application/json"}})).data.code===1?p.notify({message:"注册成功!",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}):p.notify({message:"账号已存在",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})};return(r,u)=>(O(),G(K,{view:"lHh Lpr lFf"},{default:b(()=>[m(X,null,{default:b(()=>[m(Y,{class:"login-page-background flex flex-center",style:{"max-width":"100%","max-height":"100%"}},{default:b(()=>[k("div",ee,[m(Z,{onSubmit:g,class:"q-gutter-md"},{default:b(()=>[m(C,{"bg-color":"white",rounded:"",outlined:"",modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=t=>s.value=t),label:"账号","lazy-rules":"",rules:[t=>t&&t.length>0||"不能为空"]},null,8,["modelValue","rules"]),m(C,{"bg-color":"white",rounded:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":u[1]||(u[1]=t=>v.value=t),label:"密码","lazy-rules":"",rules:[t=>t!==null&&t!==""||"不能为空",t=>t.length>0&&t.length<20||"密码过长"]},null,8,["modelValue","rules"]),k("div",te,[m(B,{label:"登录",type:"login",color:"blue"}),m(B,{label:"注册",onClick:h,color:"blue"}),m(A,{label:"记住密码","checked-icon":"star","unchecked-icon":"star_border",modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=t=>a.value=t)},null,8,["modelValue"])])]),_:1})])]),_:1})]),_:1})]),_:1}))}},le=M(oe,[["__scopeId","data-v-4761a20b"],["__file","LoginLayout.vue"]]);export{le as default};
