import{ref as j,onMounted as ne,resolveComponent as g,mergeProps as ue,withCtx as a,createTextVNode as k,createVNode as e,useSSRContext as se}from"vue";import{ssrRenderComponent as d,ssrRenderStyle as de}from"vue/server-renderer";import{useQuasar as re}from"quasar";import H from"axios";import{useRouter as ce}from"vue-router";import{_ as ie,u as pe}from"../server-entry.js";import"quasar/wrappers/index.mjs";import"pinia";const Q={__name:"LoginLayout",__ssrInlineRender:!0,setup(J){const i=re(),s=j(null),c=j(null),R=ce(),K=pe(),p=j(!1),r=j({label:null,value:null}),x=j([{label:"学生管理系统",value:"systemA"},{label:"项目管理系统",value:"systemB"},{label:"测试系统",value:"authentication"}]),q=async()=>{await R.push("mainlayout")},M=async()=>{if(i.loadingBar.start(),i.loadingBar.stop(),grecaptcha.getResponse().length===0){i.notify({message:"请进行人机身份验证",position:"top"});return}if(!r.value){i.notify({message:"请选择一个系统",position:"top",color:"red",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"});return}const A=await H.post(`https://test.opensun.asia/api/${r.value.value}/client-login`,{username:s.value,password:c.value,"remember-me":p.value?"on":"off"},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});A.data.code===1?(sessionStorage.setItem("jwt",A.headers.getAuthorization()),i.notify({message:"欢迎!",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}),K.login(),await R.push("/mainlayout")):i.notify({message:A.data.message,position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})},U=async()=>{if(!r.value.value){i.notify({message:"请选择一个系统",position:"top",color:"red",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"});return}(await H.post(`https://test.opensun.asia/api/${r.value.value}/client-register`,{username:s.value,password:c.value},{headers:{"Content-Type":"application/json"}})).data.code===1?(i.notify({message:"注册成功!",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}),K.login(),await R.push("/mainlayout")):i.notify({message:"账号已存在",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})};return ne(async()=>{const v=document.createElement("script");v.src="https://recaptcha.net/recaptcha/api.js",v.async=!0,v.defer=!0,document.body.appendChild(v)}),(v,A,G,W)=>{const Z=g("q-layout"),O=g("q-page-container"),$=g("q-page"),S=g("q-form"),w=g("q-select"),b=g("q-input"),o=g("q-btn"),V=g("q-badge"),_=g("q-avatar"),y=g("q-icon"),C=g("q-checkbox");A(d(Z,ue({view:"lHh Lpr lFf"},W),{default:a((me,Y,I,ee)=>{if(Y)Y(d(O,null,{default:a((t,B,le,ae)=>{if(B)B(d($,{class:"login-page-background flex flex-center",style:{"max-width":"100%","max-height":"100%"}},{default:a((n,X,oe,T)=>{if(X)X(`<div class="q-pa-md" style="${de({"max-width":"400px"})}" data-v-42c56710${T}>`),X(d(S,{onSubmit:M,class:"q-gutter-md"},{default:a((u,m,h,f)=>{if(m)m(d(w,{modelValue:r.value,"onUpdate:modelValue":l=>r.value=l,options:x.value,label:"选择系统",outlined:"",dense:"",clearable:"",color:"black","bg-color":"teal"},null,h,f)),m(d(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,label:"账号","lazy-rules":"",rules:[l=>l&&l.length>0||"不能为空"]},null,h,f)),m(d(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:c.value,"onUpdate:modelValue":l=>c.value=l,label:"密码","lazy-rules":"",rules:[l=>l!==null&&l!==""||"不能为空",l=>l.length>0&&l.length<20||"密码过长"]},null,h,f)),m(`<div class="g-recaptcha" data-sitekey="6Ld8j_spAAAAAJpQxXF2uy3cM3YOLPgCzfM2vgXK" data-callback="login" data-v-42c56710${f}></div><div class="row justify-around" data-v-42c56710${f}>`),m(d(o,{push:"",label:"登录",type:"login",color:"teal","text-color":"black"},{default:a((l,z,F,P)=>{if(z)z(d(V,{color:"orange",floating:""},{default:a((te,L,N,E)=>{if(L)L("999");else return[k("999")]}),_:1},F,P));else return[e(V,{color:"orange",floating:""},{default:a(()=>[k("999")]),_:1})]}),_:1},h,f)),m(d(o,{push:"",label:"注册",onClick:U,color:"teal"},null,h,f)),m(d(o,{push:"",label:"匿名访问",onClick:q,color:"teal"},null,h,f)),m(d(o,{push:"",href:"https://test.opensun.asia/oauth2/authorization/github",color:"teal"},{default:a((l,z,F,P)=>{if(z)z(d(_,null,{default:a((te,L,N,E)=>{if(L)L(d(y,{name:"fa-brands fa-github"},null,N,E));else return[e(y,{name:"fa-brands fa-github"})]}),_:1},F,P));else return[e(_,null,{default:a(()=>[e(y,{name:"fa-brands fa-github"})]),_:1})]}),_:1},h,f)),m(d(C,{label:"记住密码","checked-icon":"star","unchecked-icon":"star_border",modelValue:p.value,"onUpdate:modelValue":l=>p.value=l},null,h,f)),m("</div>");else return[e(w,{modelValue:r.value,"onUpdate:modelValue":l=>r.value=l,options:x.value,label:"选择系统",outlined:"",dense:"",clearable:"",color:"black","bg-color":"teal"},null,8,["modelValue","onUpdate:modelValue","options"]),e(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,label:"账号","lazy-rules":"",rules:[l=>l&&l.length>0||"不能为空"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:c.value,"onUpdate:modelValue":l=>c.value=l,label:"密码","lazy-rules":"",rules:[l=>l!==null&&l!==""||"不能为空",l=>l.length>0&&l.length<20||"密码过长"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e("div",{class:"g-recaptcha","data-sitekey":"6Ld8j_spAAAAAJpQxXF2uy3cM3YOLPgCzfM2vgXK","data-callback":"login"}),e("div",{class:"row justify-around"},[e(o,{push:"",label:"登录",type:"login",color:"teal","text-color":"black"},{default:a(()=>[e(V,{color:"orange",floating:""},{default:a(()=>[k("999")]),_:1})]),_:1}),e(o,{push:"",label:"注册",onClick:U,color:"teal"}),e(o,{push:"",label:"匿名访问",onClick:q,color:"teal"}),e(o,{push:"",href:"https://test.opensun.asia/oauth2/authorization/github",color:"teal"},{default:a(()=>[e(_,null,{default:a(()=>[e(y,{name:"fa-brands fa-github"})]),_:1})]),_:1}),e(C,{label:"记住密码","checked-icon":"star","unchecked-icon":"star_border",modelValue:p.value,"onUpdate:modelValue":l=>p.value=l},null,8,["modelValue","onUpdate:modelValue"])])]}),_:1},oe,T)),X("</div>");else return[e("div",{class:"q-pa-md",style:{"max-width":"400px"}},[e(S,{onSubmit:M,class:"q-gutter-md"},{default:a(()=>[e(w,{modelValue:r.value,"onUpdate:modelValue":u=>r.value=u,options:x.value,label:"选择系统",outlined:"",dense:"",clearable:"",color:"black","bg-color":"teal"},null,8,["modelValue","onUpdate:modelValue","options"]),e(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:s.value,"onUpdate:modelValue":u=>s.value=u,label:"账号","lazy-rules":"",rules:[u=>u&&u.length>0||"不能为空"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:c.value,"onUpdate:modelValue":u=>c.value=u,label:"密码","lazy-rules":"",rules:[u=>u!==null&&u!==""||"不能为空",u=>u.length>0&&u.length<20||"密码过长"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e("div",{class:"g-recaptcha","data-sitekey":"6Ld8j_spAAAAAJpQxXF2uy3cM3YOLPgCzfM2vgXK","data-callback":"login"}),e("div",{class:"row justify-around"},[e(o,{push:"",label:"登录",type:"login",color:"teal","text-color":"black"},{default:a(()=>[e(V,{color:"orange",floating:""},{default:a(()=>[k("999")]),_:1})]),_:1}),e(o,{push:"",label:"注册",onClick:U,color:"teal"}),e(o,{push:"",label:"匿名访问",onClick:q,color:"teal"}),e(o,{push:"",href:"https://test.opensun.asia/oauth2/authorization/github",color:"teal"},{default:a(()=>[e(_,null,{default:a(()=>[e(y,{name:"fa-brands fa-github"})]),_:1})]),_:1}),e(C,{label:"记住密码","checked-icon":"star","unchecked-icon":"star_border",modelValue:p.value,"onUpdate:modelValue":u=>p.value=u},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})])]}),_:1},le,ae));else return[e($,{class:"login-page-background flex flex-center",style:{"max-width":"100%","max-height":"100%"}},{default:a(()=>[e("div",{class:"q-pa-md",style:{"max-width":"400px"}},[e(S,{onSubmit:M,class:"q-gutter-md"},{default:a(()=>[e(w,{modelValue:r.value,"onUpdate:modelValue":n=>r.value=n,options:x.value,label:"选择系统",outlined:"",dense:"",clearable:"",color:"black","bg-color":"teal"},null,8,["modelValue","onUpdate:modelValue","options"]),e(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:s.value,"onUpdate:modelValue":n=>s.value=n,label:"账号","lazy-rules":"",rules:[n=>n&&n.length>0||"不能为空"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:c.value,"onUpdate:modelValue":n=>c.value=n,label:"密码","lazy-rules":"",rules:[n=>n!==null&&n!==""||"不能为空",n=>n.length>0&&n.length<20||"密码过长"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e("div",{class:"g-recaptcha","data-sitekey":"6Ld8j_spAAAAAJpQxXF2uy3cM3YOLPgCzfM2vgXK","data-callback":"login"}),e("div",{class:"row justify-around"},[e(o,{push:"",label:"登录",type:"login",color:"teal","text-color":"black"},{default:a(()=>[e(V,{color:"orange",floating:""},{default:a(()=>[k("999")]),_:1})]),_:1}),e(o,{push:"",label:"注册",onClick:U,color:"teal"}),e(o,{push:"",label:"匿名访问",onClick:q,color:"teal"}),e(o,{push:"",href:"https://test.opensun.asia/oauth2/authorization/github",color:"teal"},{default:a(()=>[e(_,null,{default:a(()=>[e(y,{name:"fa-brands fa-github"})]),_:1})]),_:1}),e(C,{label:"记住密码","checked-icon":"star","unchecked-icon":"star_border",modelValue:p.value,"onUpdate:modelValue":n=>p.value=n},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})])]),_:1})]}),_:1},I,ee));else return[e(O,null,{default:a(()=>[e($,{class:"login-page-background flex flex-center",style:{"max-width":"100%","max-height":"100%"}},{default:a(()=>[e("div",{class:"q-pa-md",style:{"max-width":"400px"}},[e(S,{onSubmit:M,class:"q-gutter-md"},{default:a(()=>[e(w,{modelValue:r.value,"onUpdate:modelValue":t=>r.value=t,options:x.value,label:"选择系统",outlined:"",dense:"",clearable:"",color:"black","bg-color":"teal"},null,8,["modelValue","onUpdate:modelValue","options"]),e(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:s.value,"onUpdate:modelValue":t=>s.value=t,label:"账号","lazy-rules":"",rules:[t=>t&&t.length>0||"不能为空"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(b,{clearable:"","bg-color":"teal",rounded:"",outlined:"",modelValue:c.value,"onUpdate:modelValue":t=>c.value=t,label:"密码","lazy-rules":"",rules:[t=>t!==null&&t!==""||"不能为空",t=>t.length>0&&t.length<20||"密码过长"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e("div",{class:"g-recaptcha","data-sitekey":"6Ld8j_spAAAAAJpQxXF2uy3cM3YOLPgCzfM2vgXK","data-callback":"login"}),e("div",{class:"row justify-around"},[e(o,{push:"",label:"登录",type:"login",color:"teal","text-color":"black"},{default:a(()=>[e(V,{color:"orange",floating:""},{default:a(()=>[k("999")]),_:1})]),_:1}),e(o,{push:"",label:"注册",onClick:U,color:"teal"}),e(o,{push:"",label:"匿名访问",onClick:q,color:"teal"}),e(o,{push:"",href:"https://test.opensun.asia/oauth2/authorization/github",color:"teal"},{default:a(()=>[e(_,null,{default:a(()=>[e(y,{name:"fa-brands fa-github"})]),_:1})]),_:1}),e(C,{label:"记住密码","checked-icon":"star","unchecked-icon":"star_border",modelValue:p.value,"onUpdate:modelValue":t=>p.value=t},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})])]),_:1})]),_:1})]}),_:1},G))}}},D=Q.setup;Q.setup=(J,i)=>{const s=se();return(s.modules||(s.modules=new Set)).add("src/layouts/LoginLayout.vue"),D?D(J,i):void 0};const ke=ie(Q,[["__scopeId","data-v-42c56710"],["__file","LoginLayout.vue"]]);export{ke as default};
